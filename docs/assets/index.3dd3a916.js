import{a as t,p as e,N as s}from"./vendor.e60448cb.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const i=new URL(t,location),n=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,l)=>{const o=new URL(t,i);if(self[e].moduleMap[o])return s(self[e].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){l(new Error(`Failed to import: ${t}`)),n(a)},onload(){s(self[e].moduleMap[o]),n(a)}});document.head.appendChild(a)})),self[e].moduleMap={}}}("assets/");const i=document.createElement("canvas");i.style.display="none",document.body.append(i);const n=class{static compose(t){return(t.r<<2*n.bit)+(t.g<<n.bit)+t.b}static delta(t,e){return Math.abs(t.r-t.r)+Math.abs(t.g-e.g)+Math.abs(t.b-e.b)}constructor(t=0,e=0,s=0){this.r=t,this.g=e,this.b=s}get hex(){return"#"+this.toString()}get rgb(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toString(){return this.r.toString(16)+this.g.toString(16)+this.b.toString(16)}delta(t){return n.delta(this,t)}get compose(){return n.compose(this)}};let l=n;l.bit=5;class o{constructor(t,e=0){this.pixels=[],this._length=0,t&&(this.pixels=t,this._length=e)}fromColors(t){return t?(this._length=t.length,t.forEach((t=>{const e=t.compose,s=this.pixels[e];s?s.num+=1:this.pixels[e]={num:1,color:t}})),this):this}iterPixels(t){Object.keys(this.pixels).forEach((e=>{t(this.pixels[e])}))}get length(){return this._length}mainColor(){const t={r:0,g:0,b:0};return this.iterPixels((e=>{t.r+=e.num*e.color.r,t.g+=e.num*e.color.g,t.b+=e.num*e.color.b})),t.r=t.r/this.length,t.g=t.g/this.length,t.b=t.b/this.length,new l(t.r,t.g,t.b)}deltaDimension(){let t="b";const e=new l(0,0,0),s=new l(255,255,255),i=["r","g","b"];this.iterPixels((t=>{i.forEach((i=>{e[i]=Math.max(e[i],t.color[i]),s[i]=Math.min(s[i],t.color[i])}))}));const n=new l;n.r=e.r-s.r,n.g=e.g-s.g,n.b=e.b-s.b;const o=Math.max(n.r,n.g,n.b);return t=o===n.r?"r":o===n.g?"g":"b",{dimension:t,middle:(e[t]+s[t])/2}}cutWithDimension(){const{dimension:t,middle:e}=this.deltaDimension(),s={length:0,pixels:[]},i={length:0,pixels:[]};return this.iterPixels((n=>{n.color[t]>e?(i.length+=n.num,i.pixels.push(n)):(s.length+=n.num,s.pixels.push(n))})),{right:new o(i.pixels,i.length),left:new o(s.pixels,s.length)}}}class r{constructor(t,e=.5){this.volumes=[],this.pixels=[];const s=function(t,e){i.width=t.naturalWidth*e,i.height=t.naturalHeight*e;const s=i.getContext("2d");return s?(s.drawImage(t,0,0,i.width,i.height),s.getImageData(0,0,i.width,i.height).data):[]}(t,e);for(let i=0,o=s.length;i<o;i+=4){const t=new l(s[i+0],s[i+1],s[i+2]);this.pixels.push(t)}const n=(new o).fromColors(this.pixels);this.volumes=[n]}getPalette(t,e=5){l.bit=e;let s=0;for(;this.volumes.length<t;){const t=[];for(let e=0,s=this.volumes.length;e<s;e++){const s=this.volumes[e],{left:i,right:n}=s.cutWithDimension();0!==i.length&&t.push(i),0!==n.length&&t.push(n)}if(this.volumes=t.sort(((t,e)=>e.length-t.length)),s===this.volumes.length){console.warn("too small pixels");break}s=this.volumes.length}const i=this.volumes.slice(0,t).map((t=>t.mainColor()));return this.getSimilarPalette(i)}getSimilarPalette(t){const e=t.length,s=new Array(e);for(let i=0;i<e;i++)s[i]={delta:765,color:new l};return this.pixels.forEach((i=>{for(let n=0;n<e;n++){const e=s[n],o=l.delta(i,t[n]);o<e.delta&&(e.delta=o,e.color=i)}})),s.map((t=>t.color))}}class a extends e{constructor(){super(),this.handleImageClick=t=>{const{configs:e}=this.state,s=new Date,i=(n=t.target,l=e.len,o={algorithm:e.algorithm,image:e.image},new r(n,o.image).getPalette(l,o.algorithm));var n,l,o;const a=new Date;this.setState({colors:i,spendTime:a.getTime()-s.getTime()})},this.handleInputChanged=(t,e)=>{const{configs:s}=this.state;s[e]=+t.target.value,this.setState({configs:s})};this.state={colors:Array(8).fill(0).map((()=>new l(255,255,255))),configs:{len:8,algorithm:1,image:.1},spendTime:0}}render(){const{colors:e,configs:s,spendTime:i}=this.state,n=Array(6).fill(0).map(((t,e)=>`./images/${e+1}.jpg`));return t("div",{className:"app"},t("h1",{className:"title"},"Img Color Palette Demo"),t("div",{className:"settings"},t("span",{className:"setting"},"algorithm complexity:",t("input",{type:"range",style:{width:"200px"},value:s.algorithm,min:"1",max:"8",onChange:t=>this.handleInputChanged(t,"algorithm")}),s.algorithm),t("span",{className:"setting"},"image quality:",t("input",{type:"range",style:{width:"200px"},value:s.image,min:"0.1",step:"0.1",max:"1",onChange:t=>this.handleInputChanged(t,"image")}),s.image.toFixed(1)),t("span",{className:"setting"},"spend time: ",i," ms")),t("div",{className:"divider"}),t("div",{className:"colors"},e.map(((e,s)=>t("div",{className:"color-box",key:`color${s}`},t("div",{className:"color",style:{backgroundColor:e.hex}}),t("div",{className:"desc title"},e.hex.toUpperCase()))))),t("div",{className:"divider"}),t("div",{className:"imgs"},n.map((e=>t("div",{className:"img",key:e},t("img",{src:e,onClick:this.handleImageClick}))))))}}s(t(a,null),document.getElementById("app"));
