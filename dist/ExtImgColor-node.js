module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(e);var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.naturalWidth,this.height=this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,this.width,this.height)}return function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(t,[{key:"clear",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"update",value:function(t){this.context.putImageData(t,0,0)}},{key:"getPixelCount",value:function(){return this.width*this.height}},{key:"getImageData",value:function(){return this.context.getImageData(0,0,this.width,this.height)}},{key:"removeCanvas",value:function(){this.canvas.parentNode.removeChild(this.canvas)}}]),t}();function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.contents=[],this.sorted=!1,this.comparator=e}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(t,[{key:"sort",value:function(){this.contents.sort(this.comparator),this.sorted=!0}},{key:"push",value:function(t){this.contents.push(t),this.sorted=!1}},{key:"peek",value:function(t){return this.sorted||this.sort(),void 0===t&&(t=this.contents.length-1),this.contents[t]}},{key:"pop",value:function(){return this.sorted||this.sort(),this.contents.pop()}},{key:"size",value:function(){return this.contents.length}},{key:"map",value:function(t){return this.contents.map(t)}},{key:"debug",value:function(){return this.sorted||this.sort(),this.contents}}]),t}();function a(t,e){return t<e?-1:t>e?1:0}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vboxes=new u(function(t,e){return a(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}return function(t,e,n){e&&s(t.prototype,e),n&&s(t,n)}(t,[{key:"push",value:function(t){this.vboxes.push({vbox:t,color:t.avg()})}},{key:"palette",value:function(){return this.vboxes.map(function(t){return t.color})}},{key:"size",value:function(){return this.vboxes.size()}},{key:"map",value:function(t){for(var e=0,n=this.size();e<n;e++)if(this.vboxes.peek(e).vbox.contains(t))return this.vboxes.peek(e).color;return this.nearest(t)}},{key:"nearest",value:function(t){for(var e=this.vboxes,n=Math.pow(255,3),r=Math.pow(255,3),o=null,i=0,u=this.size();i<u;i++)(r=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<n&&(n=r,o=e.peek(i).color);return o}}]),t}(),h=5,f=8-h;function l(t,e,n){return(t<<2*h)+(e<<h)+n}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),t}var b=function(){function t(e,n,r,o,i,u,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.r1=e,this.r2=n,this.g1=r,this.g2=o,this.b1=i,this.b2=u,this.histo=a}return p(t,null,[{key:"vboxFromPixels",value:function(e,n){var r,o,i,u=1e6,a=0,s=1e6,c=0,h=1e6,l=0;return e.forEach(function(t){r=t[0]>>f,o=t[1]>>f,i=t[2]>>f,u=r<u?r:u,s=o<s?o:s,h=i<h?i:h,a=r>a?r:a,c=o>c?o:c,l=i>l?i:l}),new t(u,a,s,c,h,l,n)}}]),p(t,[{key:"volume",value:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume}},{key:"count",value:function(t){var e=0,n=0;if(!this._count_set||t){for(var r=this.r1;r<=this.r2;r++)for(var o=this.g1;o<=this.g2;o++)for(var i=this.b1;i<=this.b2;i++)e=l(r,o,i),n+=this.histo[e]||0;this._count=n,this._count_set=!0}return this._count}},{key:"copy",value:function(){return new t(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)}},{key:"avg",value:function(t){if(!this._avg||t){for(var e,n=1<<8-h,r=0,o=0,i=0,u=0,a=0,s=this.r1;s<=this.r2;s++)for(var c=this.g1;c<=this.g2;c++)for(var f=this.b1;f<=this.b2;f++)e=l(s,c,f),r+=o=this.histo[e]||0,i+=o*(s+.5)*n,u+=o*(c+.5)*n,a+=o*(f+.5)*n;this._avg=r?[~~(i/r),~~(u/r),~~(a/r)]:[~~(n*(this.r1+this.r2+1)/2),~~(n*(this.g1+this.g2+1)/2),~~(n*(this.b1+this.b2+1)/2)]}return this._avg}},{key:"contains",value:function(t){var e=t[0]>>f,n=t[1]>>f,r=t[2]>>f;return e>=this.r1&&e<=this.r2&&n>=this.g1&&n<=this.g2&&r>=this.b1&&r<=this.b2}}]),t}();function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var g=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){e&&y(t.prototype,e),n&&y(t,n)}(t,[{key:"medianCutApply",value:function(t,e){var n=e.r2-e.r1+1,r=e.g2-e.g1+1,o=e.b2-e.b1+1,i=Math.max(n,r,o);if(1==e.count())return[e.copy()];var u,a,s,c,h=0,f=[],v=[];if(i==n)for(u=e.r1;u<=e.r2;u++){for(c=0,a=e.g1;a<=e.g2;a++)for(s=e.b1;s<=e.b2;s++)c+=t[l(u,a,s)]||0;h+=c,f[u]=h}else if(i==r)for(u=e.g1;u<=e.g2;u++){for(c=0,a=e.r1;a<=e.r2;a++)for(s=e.b1;s<=e.b2;s++)c+=t[l(a,u,s)]||0;h+=c,f[u]=h}else for(u=e.b1;u<=e.b2;u++){for(c=0,a=e.r1;a<=e.r2;a++)for(s=e.g1;s<=e.g2;s++)c+=t[l(a,s,u)]||0;h+=c,f[u]=h}function p(t){var n,r,o,i,a,s=t+"1",c=t+"2",l=0;for(u=e[s];u<=e[c];u++)if(f[u]>h/2){for(a=(n=u-e[s])<=(r=e[c]-u)?Math.min(e[c]-1,~~(u+r/2)):Math.max(e[s],~~(u-1-n/2));!f[a];)a++;for(l=v[a];!l&&f[a-1];)l=v[--a];return o=e.copy(),i=e.copy(),o[c]=a,i[s]=o[c]+1,[o,i]}}return f.forEach(function(t,e){v[e]=h-t}),p(i==n?"r":i==r?"g":"b")}},{key:"quantize",value:function(t,e){if(!t.length||e<2||e>256)return!1;var n=function(t){var e,n,r,o,i=new Array(1<<3*h);return t.forEach(function(t){n=t[0]>>f,r=t[1]>>f,o=t[2]>>f,e=l(n,r,o),i[e]=(i[e]||0)+1}),i}(t),r=b.vboxFromPixels(t,n),o=new u(function(t,e){return a(t.count(),e.count())});o.push(r);this.iter(n,o,.75*e);for(var i=new u(function(t,e){return a(t.count()*t.volume(),e.count()*e.volume())});o.size();)i.push(o.pop());i.push(r),this.iter(n,i,e-i.size());for(var s=new c;i.size();)s.push(i.pop());return s}},{key:"iter",value:function(t,e,n){for(var r,o=1,i=0;i<1e3;)if((r=e.pop()).count()){var u=this.medianCutApply(t,r),a=u[0],s=u[1];if(!a)return;if(e.push(a),s&&(e.push(s),o++),o>=n)return;if(i++>1e3)return}else e.push(r),i++}}]),t}());function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.d(e,"default",function(){return d});var d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){e&&m(t.prototype,e),n&&m(t,n)}(t,[{key:"getColorAsync",value:function(t,e){var n=this;return new Promise(function(r,o){var i=n.getColor(t,e);i?r(i):o(i)})}},{key:"getPaletteAsync",value:function(t,e,n){var r=this;return new Promise(function(o,i){var u=r.getPalette(t,e,n);u?o(u):i(u)})}},{key:"getColor",value:function(t,e){return this.getPalette(t,5,e)[0]}},{key:"getPalette",value:function(t,e,n){("number"!=typeof e||e<2||e>256)&&(e=10),("number"!=typeof n||n<1)&&(n=10);for(var r,i,u,a,s=new o(t),c=s.getImageData().data,h=s.getPixelCount(),f=[],l=0;l<h;l+=n)i=c[(r=4*l)+0],u=c[r+1],a=c[r+2],c[r+3]>=125&&(i>250&&u>250&&a>250||f.push([i,u,a]));var v=g.quantize(f,e),p=v?v.palette():null;return s.removeCanvas(),p}}]),t}()}]);