!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);class n{constructor(t=0,e=0,r=0){this.r=t,this.g=e,this.b=r}static compose(t){return(t.r<<2*n.bit)+(t.g<<n.bit)+t.b}static delta(t,e){return Math.abs(t.r-t.r)+Math.abs(t.g-e.g)+Math.abs(t.b-e.b)}set r(t){this._r=Math.round(t)}set g(t){this._g=Math.round(t)}set b(t){this._b=Math.round(t)}get r(){return this._r}get g(){return this._g}get b(){return this._b}get hex(){return"#"+this.toString()}get rgb(){return`rgb(${this._r}, ${this._g}, ${this._b})`}toString(){return this._r.toString(16)+this._g.toString(16)+this._b.toString(16)}delta(t){return n.delta(this,t)}get compose(){return n.compose(this)}}n.bit=8;class o{constructor(t,e){this.pixels=[],this._length=0,t&&(this.pixels=t,this._length=e)}fromColors(t){if(t)return this._length=t.length,t.forEach(t=>{const e=t.compose,r=this.pixels[e];r?r.num+=1:this.pixels[e]={num:1,color:t}}),this}iterPixels(t){Object.keys(this.pixels).forEach(e=>{t(this.pixels[e])})}get length(){return this._length}mainColor(){const t={r:0,g:0,b:0},e=new n;this.iterPixels(e=>{t.r+=e.num*e.color.r,t.g+=e.num*e.color.g,t.b+=e.num*e.color.b}),t.r=t.r/this.length,t.g=t.g/this.length,t.b=t.b/this.length;let r=765;return this.iterPixels(o=>{const s=n.delta(t,o.color);s<r&&(e.r=o.color.r,e.g=o.color.g,e.b=o.color.b,r=s)}),e}deltaDimension(){let t="";const e=new n(0,0,0),r=new n(255,255,255),o=["r","g","b"];this.iterPixels(t=>{o.forEach(n=>{e[n]=Math.max(e[n],t.color[n]),r[n]=Math.min(r[n],t.color[n])})});const s=new n;s.r=e.r-r.r,s.g=e.g-r.g,s.b=e.b-r.b;const i=Math.max(s.r,s.g,s.b);return{dimension:t=i===s.r?"r":i===s.g?"g":"b",middle:(e[t]+r[t])/2}}cutWidthDimension(){const{dimension:t,middle:e}=this.deltaDimension(),r={length:0,pixels:[]},n={length:0,pixels:[]};return this.iterPixels(o=>{o.color[t]>e?(n.length+=o.num,n.pixels.push(o)):(r.length+=o.num,r.pixels.push(o))}),{right:new o(n.pixels,n.length),left:new o(r.pixels,r.length)}}}class s{constructor(t){this.volumes=[];const e=(new o).fromColors(t);this.volumes=[e]}getPalette(t){let e=0;for(;this.volumes.length<t;){const t=[];for(let e=0,r=this.volumes.length;e<r;e++){const r=this.volumes[e],{left:n,right:o}=r.cutWidthDimension();0!==n.length&&t.push(n),0!==o.length&&t.push(o)}if(this.volumes=t.sort((t,e)=>e.length-t.length),e===this.volumes.length){console.warn("too small pixels");break}e=this.volumes.length}return this.volumes.map(t=>t.mainColor()).slice(0,t)}}document.querySelectorAll(".img").forEach(t=>{t.addEventListener("click",()=>{!function(t,e=1){const r=i.getContext("2d");i.width=t.width*e,i.height=t.height*e,r.drawImage(t,0,0,i.width,i.height);const o=r.getImageData(0,0,i.width,i.height).data,l=[];for(let t=0,e=o.length;t<e;t+=4){const e=new n(o[t+0],o[t+1],o[t+2]);l.push(e)}const h=new s(l);window.mmcq=h,console.time("mmcq");const c=h.getPalette(8);console.timeEnd("mmcq"),document.querySelectorAll(".js-color").forEach((t,e)=>{c[e]&&(t.style.backgroundColor=c[e].rgb)})}(t.children[0])})});const i=document.createElement("canvas");document.body.append(i)}]);