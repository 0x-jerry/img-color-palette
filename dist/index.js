!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){},r={},i=[],s=[];function l(e,t){var n,l,a,c,u=s;for(c=arguments.length;c-- >2;)i.push(arguments[c]);for(t&&null!=t.children&&(i.length||i.push(t.children),delete t.children);i.length;)if((l=i.pop())&&void 0!==l.pop)for(c=l.length;c--;)i.push(l[c]);else"boolean"==typeof l&&(l=null),(a="function"!=typeof e)&&(null==l?l="":"number"==typeof l?l=String(l):"string"!=typeof l&&(a=!1)),a&&n?u[u.length-1]+=l:u===s?u=[l]:u.push(l),n=a;var p=new o;return p.nodeName=e,p.children=u,p.attributes=null==t?void 0:t,p.key=null==t?void 0:t.key,void 0!==r.vnode&&r.vnode(p),p}function a(e,t){for(var n in t)e[n]=t[n];return e}function c(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var u="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;var p=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,d=[];function h(e){!e._dirty&&(e._dirty=!0)&&1==d.push(e)&&(r.debounceRendering||u)(m)}function m(){for(var e;e=d.pop();)e._dirty&&E(e)}function f(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&g(e,t.nodeName):n||e._componentConstructor===t.nodeName}function g(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function v(e){var t=a({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function _(e){var t=e.parentNode;t&&t.removeChild(e)}function b(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)c(n,null),c(o,e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===p.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,y,s):e.removeEventListener(t,y,s),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var l=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?l?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(l?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function y(e){return this._listeners[e.type](r.event&&r.event(e)||e)}var x=[],C=0,N=!1,w=!1;function S(){for(var e;e=x.shift();)r.afterMount&&r.afterMount(e),e.componentDidMount&&e.componentDidMount()}function k(e,t,n,o,r,i){C++||(N=null!=r&&void 0!==r.ownerSVGElement,w=null!=e&&!("__preactattr_"in e));var s=P(e,t,n,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--C||(w=!1,i||S()),s}function P(e,t,n,o,r){var i=e,s=N;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),M(e,!0))),i.__preactattr_=!0,i;var l=t.nodeName;if("function"==typeof l)return function(e,t,n,o){var r=e&&e._component,i=r,s=e,l=r&&e._componentConstructor===t.nodeName,a=l,c=v(t);for(;r&&!a&&(r=r._parentComponent);)a=r.constructor===t.nodeName;r&&a&&(!o||r._component)?(j(r,c,3,n,o),e=r.base):(i&&!l&&(I(i),e=s=null),r=D(t.nodeName,c,n),e&&!r.nextBase&&(r.nextBase=e,s=null),j(r,c,1,n,o),e=r.base,s&&e!==s&&(s._component=null,M(s,!1)));return e}(e,t,n,o);if(N="svg"===l||"foreignObject"!==l&&N,l=String(l),(!e||!g(e,l))&&(i=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}(l,N),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),M(e,!0)}var a=i.firstChild,c=i.__preactattr_,u=t.children;if(null==c){c=i.__preactattr_={};for(var p=i.attributes,d=p.length;d--;)c[p[d].name]=p[d].value}return!w&&u&&1===u.length&&"string"==typeof u[0]&&null!=a&&void 0!==a.splitText&&null==a.nextSibling?a.nodeValue!=u[0]&&(a.nodeValue=u[0]):(u&&u.length||null!=a)&&function(e,t,n,o,r){var i,s,l,a,c,u=e.childNodes,p=[],d={},h=0,m=0,g=u.length,v=0,b=t?t.length:0;if(0!==g)for(var y=0;y<g;y++){var x=u[y],C=x.__preactattr_,N=b&&C?x._component?x._component.__key:C.key:null;null!=N?(h++,d[N]=x):(C||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(p[v++]=x)}if(0!==b)for(var y=0;y<b;y++){a=t[y],c=null;var N=a.key;if(null!=N)h&&void 0!==d[N]&&(c=d[N],d[N]=void 0,h--);else if(m<v)for(i=m;i<v;i++)if(void 0!==p[i]&&f(s=p[i],a,r)){c=s,p[i]=void 0,i===v-1&&v--,i===m&&m++;break}c=P(c,a,n,o),l=u[y],c&&c!==e&&c!==l&&(null==l?e.appendChild(c):c===l.nextSibling?_(l):e.insertBefore(c,l))}if(h)for(var y in d)void 0!==d[y]&&M(d[y],!1);for(;m<=v;)void 0!==(c=p[v--])&&M(c,!1)}(i,u,n,o,w||null!=c.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||b(e,o,n[o],n[o]=void 0,N);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||b(e,o,n[o],n[o]=t[o],N)}(i,t.attributes,c),N=s,i}function M(e,t){var n=e._component;n?I(n):(null!=e.__preactattr_&&c(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||_(e),T(e))}function T(e){for(e=e.lastChild;e;){var t=e.previousSibling;M(e,!0),e=t}}var U=[];function D(e,t,n){var o,r=U.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),L.call(o,t,n)):((o=new L(t,n)).constructor=e,o.render=B);r--;)if(U[r].constructor===e)return o.nextBase=U[r].nextBase,U.splice(r,1),o;return o}function B(e,t,n){return this.constructor(e,n)}function j(e,t,n,o,i){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=o),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===r.syncComponentUpdates&&e.base?h(e):E(e,1,i)),c(e.__ref,e))}function E(e,t,n,o){if(!e._disable){var i,s,l,c=e.props,u=e.state,p=e.context,d=e.prevProps||c,h=e.prevState||u,m=e.prevContext||p,f=e.base,g=e.nextBase,_=f||g,b=e._component,y=!1,N=m;if(e.constructor.getDerivedStateFromProps&&(u=a(a({},u),e.constructor.getDerivedStateFromProps(c,u)),e.state=u),f&&(e.props=d,e.state=h,e.context=m,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,u,p)?y=!0:e.componentWillUpdate&&e.componentWillUpdate(c,u,p),e.props=c,e.state=u,e.context=p),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!y){i=e.render(c,u,p),e.getChildContext&&(p=a(a({},p),e.getChildContext())),f&&e.getSnapshotBeforeUpdate&&(N=e.getSnapshotBeforeUpdate(d,h));var w,P,T=i&&i.nodeName;if("function"==typeof T){var U=v(i);(s=b)&&s.constructor===T&&U.key==s.__key?j(s,U,1,p,!1):(w=s,e._component=s=D(T,U,p),s.nextBase=s.nextBase||g,s._parentComponent=e,j(s,U,0,p,!1),E(s,1,n,!0)),P=s.base}else l=_,(w=b)&&(l=e._component=null),(_||1===t)&&(l&&(l._component=null),P=k(l,i,p,n||!f,_&&_.parentNode,!0));if(_&&P!==_&&s!==b){var B=_.parentNode;B&&P!==B&&(B.replaceChild(P,_),w||(_._component=null,M(_,!1)))}if(w&&I(w),e.base=P,P&&!o){for(var L=e,W=e;W=W._parentComponent;)(L=W).base=P;P._component=L,P._componentConstructor=L.constructor}}for(!f||n?x.push(e):y||(e.componentDidUpdate&&e.componentDidUpdate(d,h,N),r.afterUpdate&&r.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);C||o||S()}}function I(e){r.beforeUnmount&&r.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?I(n):t&&(null!=t.__preactattr_&&c(t.__preactattr_.ref,null),e.nextBase=t,_(t),U.push(e),T(t)),c(e.__ref,null)}function L(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function W(e,t,n){return k(n,e,{},!1,t,!1)}a(L.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=a(a({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),h(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),E(this,2)},render:function(){}});const O=document.createElement("canvas");O.style.display="none",document.body.append(O);class A{constructor(e=0,t=0,n=0){this.r=e,this.g=t,this.b=n}static compose(e){return(e.r<<2*A.bit)+(e.g<<A.bit)+e.b}static delta(e,t){return Math.abs(e.r-e.r)+Math.abs(e.g-t.g)+Math.abs(e.b-t.b)}get hex(){return"#"+this.toString()}get rgb(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toString(){return this.r.toString(16)+this.g.toString(16)+this.b.toString(16)}delta(e){return A.delta(this,e)}get compose(){return A.compose(this)}}A.bit=5;class ${constructor(e,t){this.pixels=[],this._length=0,e&&(this.pixels=e,this._length=t)}fromColors(e){if(e)return this._length=e.length,e.forEach(e=>{const t=e.compose,n=this.pixels[t];n?n.num+=1:this.pixels[t]={num:1,color:e}}),this}iterPixels(e){Object.keys(this.pixels).forEach(t=>{e(this.pixels[t])})}get length(){return this._length}mainColor(){const e={r:0,g:0,b:0};return this.iterPixels(t=>{e.r+=t.num*t.color.r,e.g+=t.num*t.color.g,e.b+=t.num*t.color.b}),e.r=e.r/this.length,e.g=e.g/this.length,e.b=e.b/this.length,new A(e.r,e.g,e.b)}deltaDimension(){let e="";const t=new A(0,0,0),n=new A(255,255,255),o=["r","g","b"];this.iterPixels(e=>{o.forEach(o=>{t[o]=Math.max(t[o],e.color[o]),n[o]=Math.min(n[o],e.color[o])})});const r=new A;r.r=t.r-n.r,r.g=t.g-n.g,r.b=t.b-n.b;const i=Math.max(r.r,r.g,r.b);return{dimension:e=i===r.r?"r":i===r.g?"g":"b",middle:(t[e]+n[e])/2}}cutWithDimension(){const{dimension:e,middle:t}=this.deltaDimension(),n={length:0,pixels:[]},o={length:0,pixels:[]};return this.iterPixels(r=>{r.color[e]>t?(o.length+=r.num,o.pixels.push(r)):(n.length+=r.num,n.pixels.push(r))}),{right:new $(o.pixels,o.length),left:new $(n.pixels,n.length)}}}class V{constructor(e,t=.5){this.volumes=[],this.pixels=[];const n=function(e,t){O.width=e.naturalWidth*t,O.height=e.naturalHeight*t;const n=O.getContext("2d");return n.drawImage(e,0,0,O.width,O.height),n.getImageData(0,0,O.width,O.height).data}(e,t);for(let e=0,t=n.length;e<t;e+=4){const t=new A(n[e+0],n[e+1],n[e+2]);this.pixels.push(t)}const o=(new $).fromColors(this.pixels);this.volumes=[o]}getPalette(e,t=5){A.bit=t;let n=0;for(;this.volumes.length<e;){const e=[];for(let t=0,n=this.volumes.length;t<n;t++){const n=this.volumes[t],{left:o,right:r}=n.cutWithDimension();0!==o.length&&e.push(o),0!==r.length&&e.push(r)}if(this.volumes=e.sort((e,t)=>t.length-e.length),n===this.volumes.length){console.warn("too small pixels");break}n=this.volumes.length}const o=this.volumes.slice(0,e).map(e=>e.mainColor());return this.getSimilarPalette(o)}getSimilarPalette(e){const t=e.length,n=new Array(t);for(let e=0;e<t;e++)n[e]={delta:765,color:null};return this.pixels.forEach(o=>{for(let r=0;r<t;r++){const t=n[r],i=A.delta(o,e[r]);i<t.delta&&(t.delta=i,t.color=o)}}),n.map(e=>e.color)}}var H=function(e,t,n){return new V(e,n.image).getPalette(t,n.algorithm)};class F extends L{constructor(){super(),this.handleImageClick=(e=>{const{configs:t}=this.state,n=new Date,o=H(e.target,t.len,{algorithm:t.algorithm,image:t.image}),r=new Date;this.setState({colors:o,spendTime:r.getTime()-n.getTime()})}),this.handleInputChanged=((e,t)=>{const{configs:n}=this.state;n[t]=+e.target.value,this.setState({configs:n})});this.state={colors:Array(8).fill(0).map(()=>new A(255,255,255)),configs:{len:8,algorithm:1,image:.1},spendTime:0}}render(){const{colors:e,configs:t,spendTime:n}=this.state,o=Array(6).fill(0).map((e,t)=>`static/images/${t+1}.jpg`);return l("div",{className:"app"},l("h1",{className:"title"},"Img Color Palette Demo"),l("div",{className:"settings"},l("span",{className:"setting"},"algorithm complexity:",l("input",{type:"range",style:{width:"200px"},value:t.algorithm,min:"1",max:"8",onChange:e=>this.handleInputChanged(e,"algorithm")}),t.algorithm),l("span",{className:"setting"},"image quality:",l("input",{type:"range",style:{width:"200px"},value:t.image,min:"0.1",step:"0.1",max:"1",onChange:e=>this.handleInputChanged(e,"image")}),t.image.toFixed(1)),l("span",{className:"setting"},"spend time: ",n," ms")),l("div",{className:"divider"}),l("div",{className:"colors"},e.map((e,t)=>l("div",{className:"color-box",key:`color${t}`},l("div",{className:"color",style:{backgroundColor:e.hex}}),l("div",{className:"desc title"},e.hex.toUpperCase())))),l("div",{className:"divider"}),l("div",{className:"imgs"},o.map(e=>l("div",{className:"img"},l("img",{src:e,onClick:this.handleImageClick})))))}}W(l(F,null),document.getElementById("app"))}]);